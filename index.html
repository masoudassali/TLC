<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lined Canvas - AI Outline Generator</title>
    <style>
        /* General Styling */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* Container for the App */
        .generator-container {
            background-color: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 30px;
            /* CRITICAL CHANGE 1: Establish positioning context for absolute logo */
            position: relative; 
        }

        /* Logo Styling */
        .logo-container {
            /* CRITICAL CHANGE 2: Position the logo absolutely at the top right */
            position: absolute; 
            top: 20px; /* Distance from the top edge of the generator-container padding */
            right: 20px; /* Distance from the right edge of the generator-container padding */
            z-index: 10; /* Ensure the logo is always on top */
        }

        .logo-container img {
            width: 80px; /* Reduced size slightly to fit neatly in the corner */
            height: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        /* Header Styling */
        h1 {
            color: #5D4037; /* Earthy brown */
            text-align: center;
            margin-top: 0; 
            margin-bottom: 5px;
            font-weight: 300;
            /* Optional: Add padding to ensure H1 content doesn't sit under the logo */
            padding-right: 100px; 
        }

        .subtitle {
            text-align: center;
            color: #795548;
            margin-bottom: 25px;
            font-style: italic;
        }

        /* Form and Input Styling (rest of CSS remains the same) */
        .prompt-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            min-height: 100px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        textarea:focus {
            border-color: #FF7043; /* Bright orange-red for focus */
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 112, 67, 0.2);
        }

        button {
            background-color: #FF7043;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
        }

        button:hover {
            background-color: #E64A19;
        }

        button:active {
            transform: translateY(1px);
        }

        /* Image Display Area */
        .image-display {
            border: 2px dashed #BDBDBD; /* Light grey dashed border */
            border-radius: 8px;
            min-height: 350px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            background-color: #FAFAFA;
        }

        .image-placeholder {
            color: #9E9E9E;
            font-style: italic;
            font-size: 18px;
        }

        .generated-image {
            max-width: 100%;
            max-height: 350px;
            border-radius: 6px;
            display: none; /* Hidden by default, show with JavaScript */
        }
    </style>
</head>
<body>

    <div class="generator-container">
        <div class="logo-container">
            <img src="https://raw.githubusercontent.com/masoudassali/TLC/refs/heads/main/TLC%20Logo.png" alt="The Lined Canvas Logo"> 
        </div>
        
        <h1>Generate Your Canvas Outline</h1>
        <p class="subtitle">Describe the image you want to paint, and our AI will create a complex outline for you.</p>

        <form class="prompt-form" id="imageGenerationForm">
            <label for="prompt">What complex design do you want an outline of?</label>
            <textarea id="prompt" name="prompt" placeholder="E.g., A whimsical cat reading a book in a cozy, sunlit cafe with a steaming mug." required></textarea>
            <button type="submit">Generate Outline</button>
        </form>

        <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), #FF7043, rgba(0, 0, 0, 0));">

        <h2>Your Generated Outline Preview</h2>

        <div class="image-display">
            <p class="image-placeholder" id="placeholderText">Your AI-generated outline preview will appear here.</p>
            <img src="" alt="AI Generated Outline" class="generated-image" id="generatedImage">
        </div>
    </div>

    <script>
        // *** JAVASCRIPT FOR FORM SUBMISSION ***
        // ðŸš¨ IMPORTANT: Ensure this URL is correct for your active n8n webhook
        const N8N_WEBHOOK_URL = 'https://steak.servequake.com/webhook-test/74161287-0f76-4b39-b5b6-66393e16ca91';
        const form = document.getElementById('imageGenerationForm');
        const promptTextarea = document.getElementById('prompt');
        const placeholderText = document.getElementById('placeholderText');
        const generatedImage = document.getElementById('generatedImage');
        const submitButton = form.querySelector('button');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const prompt = promptTextarea.value.trim();
            if (!prompt) return;

            // 1. Update UI for 'Loading' state
            submitButton.textContent = 'Generating... Please wait.';
            submitButton.disabled = true;
            placeholderText.textContent = 'Generating your unique outline... (Expecting PNG data)';
            placeholderText.style.display = 'block';
            generatedImage.style.display = 'none';

            try {
                // 2. Send prompt to n8n webhook
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // Send the prompt as a JSON object
                    body: JSON.stringify({ prompt: prompt }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // *** Handle the incoming binary image data (PNG) ***
                const imageBlob = await response.blob(); 
                
                if (imageBlob.type && imageBlob.type.startsWith('image/')) {
                    const imageUrl = URL.createObjectURL(imageBlob); 
                    
                    // 3. Update UI with the result
                    generatedImage.src = imageUrl;
                    generatedImage.alt = prompt;
                    
                    generatedImage.onload = () => {
                        placeholderText.style.display = 'none';
                        generatedImage.style.display = 'block';
                        // Revoke the temporary URL after the image has loaded to free up memory
                        URL.revokeObjectURL(imageUrl); 
                    };

                    generatedImage.onerror = () => {
                        placeholderText.textContent = 'Error loading image data. The response might not be a valid image.';
                        generatedImage.style.display = 'none';
                    };
                } else {
                    const errorText = await imageBlob.text(); 
                    placeholderText.textContent = `Generation failed. N8N did not return a valid image file. Raw response: ${errorText.substring(0, 100)}...`;
                }

            } catch (error) {
                console.error('Generation Error:', error);
                placeholderText.textContent = `An error occurred: ${error.message}. Please ensure your n8n workflow is active and configured to return a binary PNG file.`;
            } finally {
                // 4. Reset button state
                submitButton.textContent = 'Generate Outline';
                submitButton.disabled = false;
            }
        });
    </script>

</body>
</html>
